version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Install Bun
        - curl -fsSL https://bun.sh/install | bash
        - export BUN_INSTALL="$HOME/.bun"
        - export PATH="$BUN_INSTALL/bin:$PATH"
        # Install dependencies with Bun
        - bun install --frozen-lockfile
    build:
      commands:
        - export BUN_INSTALL="$HOME/.bun"
        - export PATH="$BUN_INSTALL/bin:$PATH"
        # Create .env.production file for runtime (Amplify SSR workaround)
        - |
          echo "WORKOS_API_KEY=$WORKOS_API_KEY" >> .env.production
          echo "WORKOS_CLIENT_ID=$WORKOS_CLIENT_ID" >> .env.production
          echo "WORKOS_COOKIE_PASSWORD=$WORKOS_COOKIE_PASSWORD" >> .env.production
          echo "DATABASE_URL=$DATABASE_URL" >> .env.production
          echo "AAWWSS_ACCESS_KEY_ID=$AAWWSS_ACCESS_KEY_ID" >> .env.production
          echo "AAWWSS_SECRET_ACCESS_KEY=$AAWWSS_SECRET_ACCESS_KEY" >> .env.production
          echo "AAWWSS_REGION=$AAWWSS_REGION" >> .env.production
          echo "S3_BUCKET_NAME=$S3_BUCKET_NAME" >> .env.production
          echo "AZURE_OPENAI_API_KEY=$AZURE_OPENAI_API_KEY" >> .env.production
          echo "AZURE_OPENAI_ENDPOINT=$AZURE_OPENAI_ENDPOINT" >> .env.production
          echo "AZURE_OPENAI_ENDPOINT=$AZURE_OPENAI_ENDPOINT" >> .env.production
          echo "NEXT_PUBLIC_APP_URL=$NEXT_PUBLIC_APP_URL" >> .env.production
          echo "GOOGLE_SERVICE_ACCOUNT_KEY=$GOOGLE_SERVICE_ACCOUNT_KEY" >> .env.production
          echo "GOOGLE_CLIENT_EMAIL=$GOOGLE_CLIENT_EMAIL" >> .env.production
          echo "GOOGLE_PRIVATE_KEY=$GOOGLE_PRIVATE_KEY" >> .env.production
          echo "GOOGLE_PROJECT_ID=$GOOGLE_PROJECT_ID" >> .env.production
          echo "GOOGLE_CLOUD_PROJECT=chatapp-by-amanm" >> .env.production
          echo "GOOGLE_CLOUD_LOCATION=global" >> .env.production
        - bun run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*



